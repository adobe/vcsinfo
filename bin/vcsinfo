#!/usr/bin/env python2.7
"""
Copyright (C) 2014 Adobe
"""

import argparse
import json
import os
import sys

# pylint: disable=W0406
import vcsinfo


def parse_args():
    """
    Setup command line argument parsing and help.
    """
    parser = argparse.ArgumentParser(
        # pylint: disable=C0301
        description='vcsinfo returns version control information for the given directory'
    )

    parser.add_argument(
        '-d', '--directory',
        default=os.getcwd(),
        dest='directory',
        # pylint: disable=C0301
        help='directory to get info for (defaults to current working directory)',
    )

    parser.add_argument(
        '-f', '--file-info',
        action='store_true',
        default=False,
        dest='include_files',
        help='include detailed file information',
    )

    return parser.parse_args()


def main():
    """
    Gets version control information for the given directory and outputs as a
    JSON document.
    """
    args = parse_args()

    # pylint: disable=I1101
    vcs = vcsinfo.detect_vcs(args.directory)
    print(json.dumps(
        vcs.info(include_files=args.include_files),
        sort_keys=True,
        indent=2,
    ))

    return os.EX_OK


if __name__ == '__main__':
    sys.exit(main())
